<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#14b8a6">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>HafalanQu</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="css/output.css"> <link rel="stylesheet" href="css/style.css">
    <meta name="description" content="Jurnal Progres Hafalan Qur'an">
    <script>
      // Skrip ini berjalan sangat cepat sebelum halaman di-render
      // untuk mencegah kedipan layar login.
      if (sessionStorage.getItem('loggedInRole')) {
        document.write('<style>#login-view { display: none; } #app { display: block; }<\/style>');
      }
    </script>
    
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/14b8a6/FFFFFF?text=HQ">

    <link href="css/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lateef:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="antialiased">
    <div id="login-view" class="flex flex-col items-center justify-center min-h-screen p-4 bg-slate-50">
        <div class="w-full max-w-sm">
            <div class="text-center mb-10">
                <h1 class="text-3xl sm:text-5xl font-bold text-teal-600">HafalanQu</h1>
                <p class="text-base text-slate-500 mt-2">Jurnal Progres Hafalan Qur'an</p>
            </div>
            <div class="card p-6 sm:p-8">
                <h2 class="text-xl font-semibold text-center text-slate-700 mb-6">Login</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium text-slate-700 mb-1">Email</label>
                        <input type="text" id="username" class="form-input" required autocomplete="username">
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                        <div class="relative">
                            <input type="password" id="password" class="form-input pr-10" required autocomplete="current-password">
                            <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-400 hover:text-slate-600 focus:outline-none">
                                <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                <svg id="eye-off-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" y1="2" x2="22" y2="22"></line></svg>
                            </button>
                        </div>
                    </div>
                    <p id="login-error" class="text-sm text-red-500 text-center mb-4 hidden"></p>
                    <button type="submit" class="btn btn-primary w-full">Masuk</button>
                </form>
            </div>
        </div>
    </div>
    <script>
      if (!window.location.hash) {
        window.location.href += '#';
      }
    </script>
    <div id="app" class="hidden">
        <div id="icon-menu-view" class="flex flex-col items-center justify-center min-h-screen p-4">
              <div class="text-center mb-10">
                  <h1 class="text-3xl sm:text-5xl font-bold text-teal-600">HafalanQu</h1>
                  <p class="text-base text-slate-500 mt-2">Jurnal Progres Hafalan Qur'an</p>
              </div>
            <div class="flex items-center justify-center flex-wrap gap-4 sm:gap-8">
                <a href="#" data-page="profil" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>Profil</span>
                </a>
                <a href="#" data-page="ringkasan" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                    <span>Pencapaian</span>
                </a>
                <a href="#" data-page="kelas" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path><path d="M10 6h4"></path><path d="M10 10h4"></path><path d="M10 14h4"></path><path d="M10 18h4"></path></svg>
                    <span>Kelas</span>
                </a>
                <a href="#" data-page="siswa" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    <span>Input Hafalan</span>
                </a>
                <a href="#" data-page="tes_hafalan" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                        <path d="m9 12 2 2 4-4"></path>
                    </svg>
                    <span>Tes Hafalan</span>
                </a>
                 <a href="#" data-page="riwayat" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    <span>Riwayat</span>
                </a>
                 <a href="#" data-page="pengaturan" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    <span>Pengaturan</span>
                </a>
                <a href="#" data-page="tentang" class="menu-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    <span>Tentang</span>
                </a>
            </div>
        </div>
        
        <main id="main-content-view" class="hidden min-h-screen p-4 sm:p-6 md:p-8">
            <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-8">
                <div class="flex items-center space-x-4">
                    <button id="home-btn" class="btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    </button>
                    <h1 id="page-title" class="text-2xl sm:text-3xl font-bold text-slate-800"></h1>
                </div>
                <div id="header-actions" class="w-full sm:w-auto">
                    </div>
            </header>
            
            <div id="loader" class="text-center py-10 flex justify-center items-center text-teal-500">
                <div class="spinner w-8 h-8"></div>
            </div>

            <div id="page-content">
                <div id="profil-page" class="page hidden">
                    <div class="max-w-3xl mx-auto space-y-8">
                        <div class="card p-6">
                            <h2 class="text-xl font-semibold text-slate-800 mb-6">Profil Saya</h2>
                            <form id="profile-form" class="space-y-4">
                                <div class="flex flex-col items-center space-y-4">
                                    <div class="relative">
                                        <img id="profile-picture-preview" src="https://placehold.co/128x128/e2e8f0/94a3b8?text=Foto" alt="Foto Profil" class="w-32 h-32 rounded-full object-cover border-4 border-slate-200">
                                        <label for="profile-picture-input" class="absolute bottom-0 right-0 bg-teal-600 text-white rounded-full p-2 cursor-pointer hover:bg-teal-700 transition-colors">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M12 20h9a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h9"></path><line x1="16" y1="16" x2="16" y2="10"></line><line x1="19" y1="13" x2="13" y2="13"></line></svg>
                                        </label>
                                        <input type="file" id="profile-picture-input" class="hidden" accept="image/*">
                                    </div>
                                    <div id="upload-progress-container" class="w-full max-w-xs hidden">
                                        <progress id="upload-progress" value="0" max="100" class="w-full"></progress>
                                    </div>
                                </div>
                                <div>
                                    <label for="profile-fullname" class="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap</label>
                                    <input type="text" id="profile-fullname" class="form-input" placeholder="Masukkan nama lengkap Anda">
                                </div>
                                <div>
                                    <label for="profile-pob" class="block text-sm font-medium text-slate-700 mb-1">Tempat, Tanggal Lahir</label>
                                    <input type="text" id="profile-pob" class="form-input" placeholder="Contoh: Brebes, 17 Agustus 1945">
                                </div>
                                <div class="flex justify-end pt-2">
                                    <button type="submit" id="save-profile-btn" class="btn btn-primary">Simpan Perubahan</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="ringkasan-page" class="page hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="card p-6 flex items-center space-x-4">
                            <div class="bg-teal-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-teal-600"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div>
                            <div>
                                <p class="text-sm text-slate-500">Total Siswa</p>
                                <p id="summary-total-siswa" class="text-3xl font-bold">0</p>
                            </div>
                        </div>
                        <div class="card p-6 flex items-center space-x-4">
                            <div class="bg-sky-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-sky-600"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path><path d="M10 6h4"></path><path d="M10 10h4"></path><path d="M10 14h4"></path><path d="M10 18h4"></path></svg></div>
                             <div>
                                <p class="text-sm text-slate-500">Total Kelas</p>
                                <p id="summary-total-kelas" class="text-3xl font-bold">0</p>
                            </div>
                        </div>
                        <div id="mutqin-card" class="card p-6">
                            <p class="text-sm text-slate-500">Skor Mutqin</p>
                            <div id="summary-mutqin-score" class="flex items-center text-2xl md:text-3xl font-bold mt-1">
                                </div>
                        </div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div class="card p-6 bg-teal-50 border border-teal-200">
                             <p class="text-sm text-teal-800 font-semibold">Ziyadah Bulan Ini</p>
                             <div id="summary-ziyadah-combined" class="flex items-baseline gap-2 text-3xl font-bold text-teal-700">
                                 </div>
                         </div>
                          <div class="card p-6 bg-sky-50 border border-sky-200">
                             <p class="text-sm text-sky-800 font-semibold">Muraja'ah Bulan Ini</p>
                              <div id="summary-murajaah-combined" class="flex items-baseline gap-2 text-3xl font-bold text-sky-700">
                                 </div>
                         </div>
                    </div>
                    <div class="card mt-8 p-4 sm:p-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-4">
                            <h2 class="text-xl font-semibold text-slate-800 whitespace-nowrap">Pencapaian Siswa</h2>
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <input type="text" id="summary-search-student" class="form-input w-full sm:w-auto" placeholder="Cari nama siswa...">
                                <select id="summary-rank-filter-class" class="form-select w-full sm:w-auto"></select>
                            </div>
                        </div>
                        <div id="student-progress-list" class="space-y-2">
                        </div>
                        <div id="pencapaian-pagination-controls" class="flex flex-wrap justify-center items-center gap-2 mt-6">
                    </div>
                </div>
            </div>
                <div id="riwayat-page" class="page hidden">
                    <div class="card p-4 sm:p-6 max-w-4xl mx-auto">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-4">
                            <h2 class="text-xl font-semibold text-slate-800 whitespace-nowrap">Riwayat Setoran</h2>
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <input type="text" id="riwayat-search-student" class="form-input w-full sm:w-auto" placeholder="Cari nama siswa...">
                                <select id="riwayat-filter-class" class="form-select w-full sm:w-auto"></select>
                            </div>
                        </div>
                        <div id="riwayat-list" class="space-y-3">
                            </div>
                        <div id="riwayat-pagination-controls" class="flex flex-wrap justify-center items-center gap-2 mt-6">
                    </div>
                </div>
            </div>
                <div id="kelas-page" class="page hidden">
                    <div class="max-w-4xl mx-auto">
                        <div class="card p-4">
                            <h2 class="text-xl font-semibold mb-4">Daftar Kelas</h2>
                            <form id="add-class-form" class="flex items-center space-x-2 mb-4">
                                <input type="text" id="class-name" class="form-input" placeholder="Buat Kelas Baru..." required>
                                <button type="submit" id="add-class-btn" class="btn btn-primary whitespace-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> <span>Tambah</span></button>
                            </form>
                            <div id="class-list" class="space-y-3">
                                </div>
                        </div>
                    </div>
                </div>

                <div id="siswa-page" class="page hidden">
                    <div class="max-w-4xl mx-auto">
                        <div class="card p-4">
                            <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
                                <h2 class="text-xl font-semibold">Daftar Siswa</h2>
                            <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                                <input type="text" id="siswa-search-student" class="form-input w-full sm:w-auto" placeholder="Cari nama siswa...">
                                <select id="student-filter-class" class="form-select w-full sm:w-auto"><option value="">Filter berdasarkan kelas</option></select>
                                <button id="add-student-modal-btn" class="btn btn-primary whitespace-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2"><circle cx="11" cy="8" r="4"></circle><path d="M4 20c0-4 4-7 7-7s7 3 7 7"></path><line x1="19" y1="6" x2="19" y2="12"></line><line x1="16" y1="9" x2="22" y2="9"></line></svg><span>Tambah</span></button>
                            </div>
                            </div>
                            <div id="student-list" class="space-y-2"></div>
                            <div id="student-pagination-controls" class="flex flex-wrap justify-center items-center gap-2 mt-6"></div>
                        </div>
                    </div>
                </div>
                <div id="pengaturan-page" class="page hidden">
                    <div class="max-w-3xl mx-auto space-y-8">
                        <div class="card p-6">
                             <h2 class="text-xl font-semibold text-slate-800 mb-1">Pengaturan Lingkup Hafalan</h2>
                            <p class="text-sm text-slate-500 mb-6">Pilih lingkup hafalan yang akan ditampilkan pada formulir entri setoran siswa di menu "Siswa".</p>
                             <form id="quran-scope-form" class="space-y-4">
                               <div class="grid grid-cols-1 items-center gap-4">
                                    <label for="quran-scope-setting" class="font-medium text-slate-700 sr-only">Pilih Lingkup</label>
                                    <select id="quran-scope-setting" class="form-select">
                                        <option value="full">Al-Qur'an 30 Juz</option>
                                        <option value="juz30">Juz 'Amma (Juz 30)</option>
                                        <option value="pilihan">Surat Pilihan</option>
                                    </select>
                                </div>
                                 <div class="flex justify-end pt-2">
                                    <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                </div>
                            </form>
                        </div>

                        <!-- Kartu Pengaturan PIN Guru (Hanya untuk Guru) -->
                        <div id="guru-pin-settings-card" class="card p-6 hidden">
                            <h2 class="text-xl font-semibold text-slate-800 mb-1">Pengaturan PIN Guru</h2>
                            <p class="text-sm text-slate-500 mb-6">Buat atau ubah PIN 6 digit Anda. PIN ini akan digunakan oleh siswa untuk verifikasi setoran.</p>
                            <form id="guru-pin-form" class="space-y-4">
                                <input type="text" name="username" autocomplete="username" style="display: none;">
                                <input type="password" name="password" autocomplete="current-password" style="display: none;">

                                <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="guru-pin-input" class="font-medium text-slate-700">PIN 6 Digit Anda</label>
                                    <div class="relative">
                                        <input type="password" id="guru-pin-input" class="form-input pr-10" placeholder="••••••" required pattern="\d{6}" maxlength="6" autocomplete="one-time-code">
                                        <button type="button" id="toggle-guru-pin" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-400 hover:text-slate-600 focus:outline-none">
                                            <svg id="guru-pin-eye-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                            <svg id="guru-pin-eye-off-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" y1="2" x2="22" y2="22"></line></svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex justify-end pt-2">
                                    <button type="submit" class="btn btn-primary">Simpan PIN</button>
                                </div>
                            </form>
                        </div>

                        <div id="mutqin-settings-card" class="card p-6">
                            <h2 class="text-xl font-semibold text-slate-800 mb-1">Pengaturan Skor Mutqin</h2>
                            <p class="text-sm text-slate-500 mb-6">Sesuaikan nilai persentase untuk setiap tingkat kualitas hafalan. Nilai ini akan digunakan untuk menghitung skor rata-rata Mutqin.</p>
                            <form id="mutqin-settings-form" class="space-y-4">
                               <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="score-sangat-lancar" class="font-medium text-slate-700">Sangat Lancar</label>
                                    <input type="number" id="score-sangat-lancar" class="form-input text-right" min="0" max="100" required>
                                </div>
                                <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="score-lancar" class="font-medium text-slate-700">Lancar</label>
                                    <input type="number" id="score-lancar" class="form-input text-right" min="0" max="100" required>
                                </div>
                                <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="score-cukup-lancar" class="font-medium text-slate-700">Cukup Lancar</label>
                                    <input type="number" id="score-cukup-lancar" class="form-input text-right" min="0" max="100" required>
                                </div>
                                <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="score-tidak-lancar" class="font-medium text-slate-700">Tidak Lancar</label>
                                    <input type="number" id="score-tidak-lancar" class="form-input text-right" min="0" max="100" required>
                                </div>
                                <div class="grid grid-cols-2 items-center gap-4">
                                    <label for="score-sangat-tidak-lancar" class="font-medium text-slate-700">Sangat Tdk Lancar</label>
                                    <input type="number" id="score-sangat-tidak-lancar" class="form-input text-right" min="0" max="100" required>
                                </div>
                                <div class="flex justify-end pt-2">
                                    <button type="submit" class="btn btn-primary">Simpan Pengaturan Skor</button>
                                </div>
                            </form>
                        </div>

                        <div class="card p-6">
                            <h2 class="text-xl font-semibold text-slate-800 mb-4">Akun</h2>
                            <p class="text-sm text-slate-500 mb-4">Keluar dari sesi Anda saat ini.</p>
                            <button id="settings-logout-btn" class="btn btn-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                <span>Keluar</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tentang-page" class="page hidden">
                    <div class="card p-6 max-w-3xl mx-auto">
                        <h2 class="text-2xl font-bold text-teal-600 mb-4">Tentang HafalanQu</h2>
                        <div class="space-y-4 text-slate-600">
                            <p>
                                HafalanQu adalah aplikasi jurnal digital yang dirancang khusus untuk membantu para pengajar Al-Qur’an dalam mencatat, mengelola, dan memantau progres hafalan para siswanya secara efisien. Dengan tampilan yang sederhana dan mudah digunakan, HafalanQu memungkinkan guru untuk menyimpan catatan setoran hafalan harian, merekap hasil penilaian, hingga memantau perkembangan hafalan setiap siswa dari waktu ke waktu.
                            </p>
                            <p>
                                Selain itu, aplikasi ini juga menyediakan fitur statistik perkembangan yang memudahkan guru dalam melihat pencapaian siswa baik secara individu maupun keseluruhan kelas. Data yang tersimpan rapi dapat dijadikan dasar dalam memberikan bimbingan yang lebih tepat sasaran sesuai kebutuhan masing-masing siswa.
                            </p>
                            <p>
                                Tidak hanya untuk guru, HafalanQu juga memberi manfaat bagi siswa karena mereka bisa lebih termotivasi dalam menghafal Al-Qur’an. Dengan adanya catatan progres yang jelas, siswa dapat melihat sejauh mana hafalan yang sudah dicapai serta bagian mana yang perlu diperbaiki.
                            </p>
                            <p>
                                HafalanQu hadir sebagai solusi modern dalam mendukung kegiatan tahfidz Al-Qur’an, menjadikan proses pencatatan lebih praktis, transparan, dan terintegrasi, sehingga guru dapat fokus pada pembinaan, sementara administrasi hafalan ditangani secara sistematis oleh aplikasi.
                            </p>
                             <div class="pt-4 mt-4 border-t">
                                <p class="text-sm">
                                    Dikembangkan oleh: <a href="https://wa.me/6285888892326" target="_blank" rel="noopener noreferrer" class="font-bold text-teal-600 hover:underline">Ahmad Zulfikar</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tes_hafalan-page" class="page hidden">
                <div class="max-w-xl mx-auto">    
                <div id="test-step-1-type" class="card p-6">
                    <h2 class="text-xl font-semibold text-slate-800 mb-6">Pengaturan Tes</h2>
                    <div>
                        <p class="block text-sm font-medium text-slate-700 mb-2">Pilih nama siswa jika ingin disimpan hasilnya</p>
                        <div id="test-selected-student-container" class="hidden">
                            <div class="flex items-center justify-between p-3 bg-teal-50 border border-teal-200 rounded-lg">
                                <div>
                                    <p class="text-sm text-slate-500">Siswa Terpilih:</p>
                                    <p id="test-selected-student-name" class="font-semibold text-teal-700"></p>
                                </div>
                                <button id="test-change-student-btn" class="btn btn-secondary btn-sm">Ganti</button>
                            </div>
                        </div>
                        <div id="test-student-search-container">
                            <div class="relative">
                                <input type="text" id="test-student-search-input" class="form-input" placeholder="Ketik nama siswa untuk mencari...">
                                <div id="test-student-search-results" class="absolute z-10 w-full mt-1 border border-slate-300 rounded-md shadow-lg max-h-60 overflow-y-auto hidden" style="background-color: rgb(255, 255, 255);">
                                    </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">Pilih Jenis Tes</h3>
                        <div class="mb-6">
                            <label for="test-type-select" class="block text-sm font-medium text-slate-700 mb-2 sr-only">Jenis Tes</label>
                            <select id="test-type-select" class="form-select">
                                <option value="continue-verse" selected="">Sambung Ayat Setelahnya</option>
                                <option value="previous-verse">Sambung Ayat Sebelumnya</option>
                                <option value="reorder-verses">Menyusun Ulang Ayat (Segera)</option>
                            </select>
                        </div>
                    </div>

                    <button id="test-next-step-btn" class="btn btn-primary w-full mt-4">Lanjut</button>
                </div>
                <div id="test-step-2-scope" class="card p-6 hidden">
                    <h2 class="text-xl font-semibold text-slate-800 mb-6">Pilih Lingkup Hafalan</h2>
                    <div class="space-y-4 mb-6">
                        
                        <div class="space-y-2">
                            <label class="text-sm font-medium text-slate-700">Berdasarkan Surah</label>
                            <div class="grid grid-cols-5 items-center gap-2">
                                <select id="test-surah-select-dari" class="form-select col-span-2"></select>
                                <span class="text-center text-slate-500 text-sm">sampai</span>
                                <select id="test-surah-select-sampai" class="form-select col-span-2"></select>
                            </div>
                        </div>

                        <p class="text-center text-sm text-slate-400">ATAU</p>

                        <div class="space-y-2">
                            <label class="text-sm font-medium text-slate-700">Berdasarkan Juz</label>
                            <div class="grid grid-cols-5 items-center gap-2">
                                <select id="test-juz-select-dari" class="form-select col-span-2"></select>
                                <span class="text-center text-slate-500 text-sm">sampai</span>
                                <select id="test-juz-select-sampai" class="form-select col-span-2"></select>
                            </div>
                        </div>

                    </div>
                    <div class="flex flex-col-reverse sm:flex-row gap-3">
                        <button id="test-back-step-btn" class="btn btn-secondary w-full sm:w-auto">Kembali</button>
                        <button id="start-test-btn" class="btn btn-primary w-full sm:flex-1">Mulai Tes</button>
                    </div>
                </div>

                    <div id="test-progress-view" class="hidden">
                        <div class="card p-6 mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold text-slate-800">Pertanyaan <span id="current-question-number">1</span>/<span id="total-questions">10</span></h2>
                                <div class="text-lg font-bold">Skor: <span id="current-score">0</span></div>
                            </div>
                            <div id="test-question-container" class="text-center">
                                <p class="text-sm text-slate-500 mb-2" id="question-instruction">Lanjutkan potongan ayat berikut:</p>
                                <p id="test-question-text" class="text-2xl font-lateef leading-relaxed text-slate-800 mb-6" dir="rtl">...</p>
                            </div>
                            <div id="test-answer-options" class="space-y-3"></div>
                            <div id="test-feedback" class="mt-4 text-center font-semibold hidden"></div>
                        </div>
                        <div id="test-controls" class="flex justify-end gap-3">
                            <button id="end-test-btn" class="btn btn-danger">Akhiri Tes</button>
                            <button id="next-question-btn" class="btn btn-secondary hidden">Lanjut</button>
                        </div>
                    </div>

                    <div id="test-result-view" class="card p-8 text-center hidden">
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">Tes Selesai!</h2>
                        <p class="text-slate-600 mb-6">Berikut adalah hasil akhir Anda.</p>
                        <p class="text-5xl font-bold text-teal-600 mb-8" id="final-score">0</p>
                        <button id="restart-test-btn" class="btn btn-primary">Ulangi Tes</button>
                    </div>

                </div>
            </div>
        </main>
    <div id="add-student-modal" class="modal hidden">
        <div class="card w-full max-w-md p-6">
            <h2 class="text-2xl font-semibold mb-4">Tambah Siswa</h2>
            
            <div class="mb-6 border-b pb-6">
                 <h3 class="text-lg font-medium mb-2 text-slate-800">Impor Data Siswa</h3>
                 <p class="text-sm text-slate-500 mb-4">Gunakan template untuk menambah banyak siswa sekaligus dari file.</p>
                 <div class="flex flex-col sm:flex-row gap-2">
                     <button type="button" id="download-template-btn" class="btn btn-secondary w-full sm:w-auto">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                         <span>Unduh Template</span>
                     </button>
                     <input type="file" id="import-file-input" class="hidden" accept=".xlsx, xls">
                     <button type="button" id="import-btn" class="btn btn-primary w-full sm:w-auto">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                          <span>Impor File</span>
                     </button>
                 </div>
            </div>

            <h3 class="text-lg font-medium mb-4 text-slate-800">Tambah Manual</h3>
            <form id="add-student-form" class="space-y-4">
                <div>
                    <label for="new-student-class" class="block text-sm font-medium text-slate-700 mb-1">Pilih Kelas</label>
                    <select id="new-student-class" class="form-select" required><option value="">-- Pilih Kelas --</option></select>
                </div>
                <div>
                    <label for="new-student-name" class="block text-sm font-medium text-slate-700 mb-1">Nama Siswa</label>
                    <input type="text" id="new-student-name" class="form-input" placeholder="Masukkan nama siswa" required>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancel-add-student" class="btn btn-secondary">Batal</button>
                    <button type="submit" id="add-student-submit-btn" class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg> <span>Tambah Siswa</span></button>
                </div>
            </form>
        </div>
    </div>
    <div id="confirm-modal" class="modal hidden">
        <div class="card w-full max-w-sm p-6 text-center">
            <h2 id="confirm-modal-title" class="text-xl font-semibold mb-2">Konfirmasi</h2>
            <p id="confirm-modal-text" class="text-slate-600 mb-6">Apakah Anda yakin?</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-modal-cancel" class="btn btn-secondary">Batal</button>
                <button id="confirm-modal-ok" class="btn btn-danger">Ya, Hapus</button>
            </div>
        </div>
    </div>
    <!-- Modal Setup Guru Baru -->
<div id="profile-setup-modal" class="modal hidden">
    <div class="card w-full max-w-md p-6">
        <h2 class="text-2xl font-semibold mb-2">Lengkapi Profil Anda</h2>
        <p class="text-slate-600 mb-6">Untuk melanjutkan, silakan lengkapi data diri Anda di bawah ini.</p>
        <form id="profile-setup-form" class="space-y-4">
            <div>
                <label for="setup-nama-lengkap" class="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap</label>
                <input type="text" id="setup-nama-lengkap" class="form-input" placeholder="Masukkan nama lengkap Anda" required>
            </div>
            <div>
                <label for="setup-ttl" class="block text-sm font-medium text-slate-700 mb-1">Tempat, Tanggal Lahir</label>
                <input type="text" id="setup-ttl" class="form-input" placeholder="Contoh: Brebes, 17 Agustus 1945" required>
            </div>
            <div id="setup-pin-container" class="hidden">
                <label for="setup-pin" class="block text-sm font-medium text-slate-700 mb-1">Buat PIN 6 Digit</label>
                <div class="relative">
                    <input type="password" id="setup-pin" class="form-input pr-10" placeholder="Masukkan 6 digit angka" pattern="\d{6}" maxlength="6" autocomplete="one-time-code">
                    <button type="button" id="toggle-setup-pin" class="absolute inset-y-0 right-0 flex items-center px-3 text-slate-400 hover:text-slate-600 focus:outline-none">
                        <svg id="setup-pin-eye-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        <svg id="setup-pin-eye-off-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" y1="2" x2="22" y2="22"></line></svg>
                    </button>
                </div>
                <p class="text-xs text-slate-500 mt-1">PIN ini akan digunakan siswa untuk verifikasi setoran.</p>
            </div>
            <div class="flex justify-end pt-4">
                <button type="submit" id="profile-setup-submit-btn" class="btn btn-primary w-full">Simpan & Lanjutkan</button>
            </div>
        </form>
    </div>
</div>
    <div id="toast-notification" class="fixed top-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg z-50">
        <p id="toast-message"></p>
    </div>

    <script id="manifest-json" type="application/json">
    {
    "name": "HafalanQu",
    "short_name": "HafalanQu",
    "start_url": "/index.html",
    "display": "standalone",
    "background_color": "#f8fafc",
    "theme_color": "#14b8a6",
    "description": "Jurnal Progres Hafalan Qur'an",
    "icons": [
        {
        "src": "https://placehold.co/192x192/14b8a6/FFFFFF?text=HQ",
        "sizes": "192x192",
        "type": "image/png",
        "purpose": "any maskable"
        },
        {
        "src": "https://placehold.co/512x512/14b8a6/FFFFFF?text=HQ",
        "sizes": "512x512",
        "type": "image/png",
        "purpose": "any maskable"
        }
    ]
    }
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script>
        const firebaseConfig = {
        apiKey: "AIzaSyB4zxl2TCsevr7KKfdpIQYE3VRyfr-rLOY",
        authDomain: "hafalanqu-app.firebaseapp.com",
        projectId: "hafalanqu-app",
        storageBucket: "hafalanqu-app.appspot.com", // <-- Perbaiki storageBucket
        messagingSenderId: "1032716870319",
        appId: "1:1032716870319:web:30bd0e7353ae806f676a5a"
        };
  // Inisialisasi Firebase
  firebase.initializeApp(firebaseConfig);
  // Buat koneksi ke Firestore Database
  const db = firebase.firestore();
  const auth = firebase.auth();
  const storage = firebase.storage(); // <-- Inisialisasi Storage
</script>
 <script src="js/app.js?v=?php echo time(); ?>"></script>
</body>
</html>
